---
jobs:
  include:
    - &build_and_run
      # Only run this job when there are changes in the subdir 'debirf'
      # if: git diff --name-only $TRAVIS_BRANCH HEAD | grep -qP '^debirf/'
      env: KERNEL=4.15.0-43-generic SUITE=xenial
      stage: build and run images
      dist: xenial
      sudo: required
      language: bash
      script: .debirf/build_and_run_images
      after_success:
        - git config --global user.email "build@travis-ci.com"
        - git config --global user.name "Travis CI"
        - git tag -a "$(date +'%Y%m%d')" -m 'Automatic release by Travis CI'
        - git push "https://${TOKEN}@github.com/${TRAVIS_REPO_SLUG}".git --tags
        - git fetch origin
        - git tag
      deploy:
        provider: releases
        api_key: ${TOKEN}
        file_glob: true
        file: build/*
        skip_cleanup: true
        on:
          branch: master
        draft: true
